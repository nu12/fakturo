%div{"data-controller" => "expenses"}
  %input{:type => "hidden",:id => "categoriesForCurrentUser", :value => "#{raw Current.user.categories.to_json(include: :subcategories)}"}
  .digg_pagination.d-flex.justify-content-center.mb-3
    = will_paginate expenses, :container => false
  
  %table.table.table-sm.table-striped
    %thead
      %tr
        %th
          %input.form-check-input{ :type => :checkbox, "data-action" => "expenses#changeAll" }
        %th Date
        %th Description
        %th Value
        - if show.include? :statement
          %th Statement date
        - if show.include? :source
          %th Source
        - if show.include? :category
          %th Category
        - if show.include? :subcategory
          %th Sub-category
        %th
          %button.btn.btn-sm{"data-bs-toggle" => "modal", "data-bs-target" => "#transferExpensesModal", "data-action" => "expenses#getSelectedSubcategories"}
            %a{"data-bs-toggle" => "tooltip", "data-bs-title" => "Edit selected"}
              %svg.bi.pe-none.me-2{ :width => "16", :height => "16", "aria-hidden" => "true" }
                %use{ "xlink:href" => "#edit" }
    %tbody
      - expenses.ordered.each do |expense|
        %tr
          %td
            %input.form-check-input{ :type => :checkbox, "data-expenses-target" => "expense", "data-id" => "#{expense.id}"}
          %td
            - if expense.date
              = expense.date.strftime("%Y-%m-%d")
            - else
              Error
          %td
            = expense.description
            - if expense.comment && expense.comment != ""
              %a{"data-bs-toggle" => "tooltip", "data-bs-title" => "#{expense.comment}"}
                %svg.bi.pe-none.me-2{ :width => "16", :height => "16", "aria-hidden" => "true" }
                  %use{ "xlink:href" => "#info" }
          %td{ :class => "#{'text-decoration-line-through fw-lighter' if expense.ignore}" }
            = format("%.2f", expense.value)
          
          - if show.include? :statement
            %td= "#{expense.statement.year}-#{"%02d" % expense.statement.month}"
          
          - if show.include? :source
            %td
              %a{"data-bs-toggle" => "tooltip", "data-bs-title" => "#{expense.statement.source.name}"}
                %svg.bi.pe-none.me-2{ :width => "16", :height => "16", "aria-hidden" => "true" }
                  %use{ "xlink:href" => "#info" }

          - if show.include? :category
            %td= expense.category.name

          - if show.include? :subcategory
            %td= expense.subcategory.name
          
          %td
            %button.btn.btn-sm{ :type => "button", "data-bs-toggle" => "modal", "data-bs-target" => "#editExpenseModal", "data-action" => "expenses#renderForm", "data-expenses-id-param" => "#{expense.id}" }
              %a{"data-bs-toggle" => "tooltip", "data-bs-title" => "Edit"}
                %svg.bi.pe-none.me-2{ :width => "16", :height => "16", "aria-hidden" => "true" }
                  %use{ "xlink:href" => "#edit" }

  .digg_pagination.d-flex.justify-content-center.mb-3
    = will_paginate expenses, :container => false
    
  .modal.fade#editExpenseModal{ :tabindex => "-1", "aria-labelledby" => "editExpenseModalLabel", "aria-hidden" => "true"}
    .modal-dialog
      .modal-content
        .modal-header
          Edit expense
          %button.btn-close{ :type => "button", "data-bs-dismiss" => "modal", "aria-label" => "Close" }
        .modal-body#formPlaceholder
  .modal.fade#transferExpensesModal{ :tabindex => "-1", "aria-labelledby" => "transferExpensesModalLabel", "aria-hidden" => "true"}
    .modal-dialog
      .modal-content
        .modal-header
          Edit selected
          %button.btn-close{ :type => "button", "data-bs-dismiss" => "modal", "aria-label" => "Close" }
        .modal-body
          .accordion#accordionExpenses
            .accordion-item
              %h2.accordion-header
                %button.accordion-button.collapsed{:type => "button", "data-bs-toggle" => "collapse", "data-bs-target" => "#collapseOne", "aria-expanded" => "false", "aria-controls" => "collapseOne"}
                  Transfer
              #collapseOne.accordion-collapse.collapse{"data-bs-parent" => "#accordionExpenses"}
                .accordion-body
                  = form_with url: bulk_expenses_path, method: :put do |f|
                    .alert.alert-info
                      The selected expenses will be transfered to the category and sub-category selected below.
                    = f.hidden_field :subcategories, {:name => "selected"}
                    .field.mb-3
                      = f.label :category_id, {class: "form-label"}
                      = f.select :category_id, Current.user.categories.map { |c| [c.name, c.id] }, { prompt: "Select a category" }, {"data-action" => "expenses#updateSubcategorySelector", class: "form-control" }
                    .field.mb-3
                      = f.label :subcategory_id, {class: "form-label"}
                      = f.select :subcategory_id, [], { prompt: "Select a category" }, {class: "form-control subcategorySelector" }
                    .actions.mb-3
                      = f.submit 'Save', class: "form-control btn btn-fakturo btn-fakturo-action"

            .accordion-item
              %h2.accordion-header
                %button.accordion-button.collapsed{:type => "button", "data-bs-toggle" => "collapse", "data-bs-target" => "#collapseTwo", "aria-expanded" => "false", "aria-controls" => "collapseTwo"}
                  Delete
              #collapseTwo.accordion-collapse.collapse{"data-bs-parent" => "#accordionExpenses"}
                .accordion-body
                  = form_with url: bulk_expenses_path, method: :delete do |f|
                    .alert.alert-danger
                      The selected expenses will be deleted.
                    = f.hidden_field :subcategories, {:name => "selected"}
                    .actions.mb-3
                      = f.submit 'Delete', class: "form-control btn btn-danger"
