= form_for @expense do |f|
  - if @expense.errors.any?
    #error_explanation
      %h2= "#{pluralize(@expense.errors.count, "error")} prohibited this expense from being saved:"
      %ul
        - @expense.errors.full_messages.each do |message|
          %li= message

  .field.mb-3
    = f.label :date, {class: "form-label"}
    = f.date_field :date, class: "form-control"
  .field.mb-3
    = f.label :description, {class: "form-label"}
    = f.text_field :description, class: "form-control"
  .field.mb-3
    = f.label :value, {class: "form-label"}
    = f.number_field :value, class: "form-control", step: 0.01
  .field.mb-3
    = f.label :comment, {class: "form-label"}
    = f.text_field :comment, class: "form-control"
  .field.mb-3
    = f.label :statement_id, {class: "form-label"}
    = f.select :statement_id, @statements.map { |d| ["#{d.source.name} (#{d.year}-#{"%02d" % d.month})", d.id] }, { prompt: "Select a statement" },{ class: "form-control" }
  .field.mb-3
    = f.label :category_id, {class: "form-label"}
    = f.select :category_id, @categories.map { |c| [c.name, c.id] }, { prompt: "Select a category" },{id: "category_id", onchange: "select_subcategory()", class: "form-control" }
  .field.mb-3
    = f.label :subcategory_id, {class: "form-label"}
    = f.select :subcategory_id, @expense.subcategory ? [ [@expense.subcategory.name, @expense.subcategory.id] ] : [], { prompt: "Select a category" }, {id: "subcategory_id", class: "form-control" }
  .field.mb-3
    = f.checkbox :ignore, class: "form-check-input"
    = f.label :ignore, {class: "form-label"}
  .actions.mb-3
    = f.submit 'Save', class: "form-control btn btn-fakturo btn-fakturo-action"

%script{:type => "text/javascript"}
  = "categories = #{raw @categories.to_json(include: :subcategories)};"
  function select_subcategory() {
  category_id = document.getElementById("category_id").value;
  selector = document.getElementById("subcategory_id");
  filter = categories.filter((c) => c.id == category_id)
  
  if (filter.length < 1) {selector.innerHTML = "<option value=\"\">Select a category</option>";}
  else{
  subcategories = filter[0].subcategories;
  selector.innerHTML = "";
  subcategories.forEach((s) =>  selector.innerHTML += "<option value=" + s.id + ">" + s.name + "</option>");
  }
  }