%h1
  Sub-category details

.container.w-50
  %table.table
    %thead
      %tr
        %th Info
        %th Value
    %tbody
      %tr
        %td Name
        %td= @subcategory.name
      %tr
        %td Description
        %td= @subcategory.description
      %tr
        %td # of expenses
        %td= "#{@subcategory.expenses.valid.count}/#{@subcategory.expenses.count}"
      %tr
        %td{colspan: "2"}
          = link_to 'Edit this sub-category', edit_category_subcategory_path(@subcategory.category, @subcategory), class: "btn btn-light form-control"
      %tr
        %td{colspan: "2"}
          %button.btn.btn-danger.form-control{:type => "button", "data-bs-toggle" => "modal", "data-bs-target" => "#deleteModal"}
            Delete this sub-category
  
= render partial: "layouts/delete_modal", locals: {element: "sub-category", link: category_subcategory_path(@subcategory.category, @subcategory)}

- if @subcategory.expenses.count > 0

  .accordion#accordionExpenses
    .accordion-item
      %h2.accordion-header
        %button.accordion-button.collapsed{:type => "button", "data-bs-toggle" => "collapse", "data-bs-target" => "#collapseOne", "aria-expanded" => "false", "aria-controls" => "collapseOne"}
          Expenses
      #collapseOne.accordion-collapse.collapse{"data-bs-parent" => "#accordionExpenses"}
        .accordion-body

          %table.table.table-sm.table-striped
            %thead
              %tr
                %th Date
                %th Description
                %th Value
                %th Statement date
                %th Source
                %th

            %tbody
              - @subcategory.expenses.each do |expense|
                %tr
                  %td= expense.date.strftime("%Y-%m-%d")
                  %td
                    = expense.description
                    - if expense.comment && expense.comment != ""
                      %a{"data-bs-toggle" => "tooltip", "data-bs-title" => "#{expense.comment}"}
                        %svg.bi.pe-none.me-2{ :width => "16", :height => "16", "aria-hidden" => "true" }
                          %use{ "xlink:href" => "#info" }
                  %td{ :class => "#{p 'text-decoration-line-through fw-lighter' if expense.ignore}" }
                    = format("%.2f", expense.value)
                  %td= "#{expense.statement.year}-#{"%02d" % expense.statement.month}"
                  %td
                    %a{"data-bs-toggle" => "tooltip", "data-bs-title" => "#{expense.statement.source.name}"}
                      %svg.bi.pe-none.me-2{ :width => "16", :height => "16", "aria-hidden" => "true" }
                        %use{ "xlink:href" => "#info" }
                  %td= link_to 'Show', category_subcategory_expense_path(@subcategory.category, @subcategory, expense)
